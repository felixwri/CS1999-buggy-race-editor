{% extends "base.html" %}

{% block content %}
<div id="welcome">
  <div class="welcome-title" onclick="remove()">
    <h1>Create new</h1>
    <p class="welcome-content">
      Create a buggy with default settings
    </p>
  </div>
  <div class="divider"></div>
  <div class="welcome-title" onclick="remove()">
    <h1> Existing </h1>
    <div class="buggies welcome-content"></div>
  </div>
</div>

<div id="filter">

  <div id="background">
    <div id="head">
      <h1 id="head-header">Developing: {{buggy_name}}</h1>
    </div>
    <div id="viewport">
    </div>
  </div>

  <section>
    <div class="mega-container">
      <div id="left">
        <div class="user">
          <img src="../static/content/images/icon.png" alt="profile">
          <h2>{{username}}</h2>
        </div>
        <div class="container">
          <h1>All Buggies</h1>
          <div class=buggies></div>
        </div>

        <div class="container">
          <h1>Stats</h1>
          <label>Cost</label>
          <div id="cost-value">0</div>
          <label>Weight</label>
          <div id="weight-value">0</div>
        </div>

        <div class="container">
          <h1 class="automate" onclick="automate()">Auto Build</h1>
        </div>

      </div>
      <div id="horizontalDragLeft" class="resizer">
        <div class="resizer-content"></div>
      </div>
      <div id="left-scaffold"></div>
    </div>

    <div class="mega-container">
      <div id="right-scaffold"></div>
      <div id="horizontalDragRight" class="resizer">
        <div class="resizer-content"></div>
      </div>
      <div id="right">
        <form action="/new" method="post">
          <div class="container">
            <div id="wheels" class="bubble hidden">
              <h2>Traction</h2>
              <label for="qty_wheels">Number of wheels</label>
              <input id="slider" type="range" name="qty_wheels" value={{qty_wheels}} min="4" max="16" step="2"
                onchange="calculate()" />
              <div id="value"></div>

              <label for="tyres">Tyre type</label>
              <select name="tyres" value={{tyres}} onchange="calculate()">
                <option value="{{tyres}}" selected hidden>{{tyres}}</option>
                <option value="knobbly">knobbly</option>
                <option value="slick">slick</option>
                <option value="steelband">steelband</option>
                <option value="reactive">reactive</option>
                <option value="maglev">maglev</option>
              </select>

              <label for="qty_tyres">Number of Tyres</label>
              <input id="slider_two" type="range" name="qty_tyres" value={{qty_tyres}} min="4" max="20" step="2"
                onchange="calculate()" />
              <div id="value_two"></div>
            </div>
          </div>

          <div class="container">
            <div id="engine" class="bubble hidden">
              <h2>Engine</h2>
              <label for="power_type">Power type</label>
              <select name="power_type" value={{power_type}} onchange="calculate()">
                <option value="{{power_type}}" selected hidden>{{power_type}}</option>
                <option value="petrol">petrol</option>
                <option value="fusion">fusion</option>
                <option value="steam">steam</option>
                <option value="bio">bio</option>
                <option value="electric">electric</option>
                <option value="rocket">rocket</option>
                <option value="hamster">hamster</option>
                <option value="thermo">thermo</option>
                <option value="solar">solar</option>
                <option value="wind">wind</option>
              </select>

              <label for="power_units">Power units</label>
              <input type="number" name="power_units" value={{power_units}} min="0" max="1000" onchange="calculate()" />

              <label for="aux_power_type">Auxillary power</label>
              <select name="aux_power_type" value={{aux_power_type}} onchange="calculate()">
                <option value="{{aux_power_type}}" selected hidden>{{aux_power_type}}</option>
                <option value="petrol">petrol</option>
                <option value="fusion">fusion</option>
                <option value="steam">steam</option>
                <option value="bio">bio</option>
                <option value="electric">electric</option>
                <option value="rocket">rocket</option>
                <option value="hamster">hamster</option>
                <option value="thermo">thermo</option>
                <option value="solar">solar</option>
                <option value="wind">wind</option>
              </select>

              <label for="aux_power_units">Auxillary units</label>
              <input type="number" name="aux_power_units" value={{aux_power_units}} min="0" max="1000"
                onchange="calculate()" />

              <label for="hamster_booster">H. booster</label>
              <input type="number" name="hamster_booster" value={{hamster_booster}} min="0" max="1000"
                onchange="calculate()" />
            </div>
          </div>


          <div class="container">
            <div id="offensive" class="bubble hidden">
              <h2>Offensive</h2>
              <label for="armour">Armour</label>
              <select name="armour" value={{armour}} onchange="calculate()">
                <option value="{{armour}}" selected hidden>{{armour}}</option>
                <option value="none">none</option>
                <option value="wood">wood</option>
                <option value="aluminium">aluminium</option>
                <option value="thinsteel">thinsteel</option>
                <option value="thicksteel">thicksteel</option>
                <option value="titanium">titanium</option>
              </select>

              <label for="attack">Attack</label>
              <select name="attack" value={{attack}} onchange="calculate()">
                <option value="{{attack}}" selected hidden>{{attack}}</option>
                <option value="none">none</option>
                <option value="spike">spike</option>
                <option value="flame">flame</option>
                <option value="charge">charge</option>
                <option value="biohazard">biohazard</option>

              </select>

              <label for="qty_attacks">Number of Attacks<label>
                  <input type="number" name="qty_attacks" value={{qty_attacks}} min="0" max="1000" onchange="calculate()" />
            </div>
          </div>

          <div class="container">
            <div id="misc" class="bubble hidden">

              <h2>Algorithm</h2>
              <select name="algo" value={{algo}}>
                <option value="{{algo}}" selected hidden>{{algo}}</option>
                <option value="defensive">defensive</option>
                <option value="steady">steady</option>
                <option value="offensive">offensive</option>
                <option value="titfortat">titfortat</option>
                <option value="birandomohazard">random</option>
              </select>

              <h2>Misc</h2>
              <label for="fireproof">Fireproof</label>
              <input id="fireproof" type="checkbox" name="fireproof" value="True">
              <input id="fireproofHidden" type="hidden" name="fireproof" value="False">


              <label for="insulated">Insulated</label>
              <input id="insulated" type="checkbox" name="insulated" value="True">
              <input id="insulatedHidden" type="hidden" name="insulated" value="False">

              <label for="antibiotic">Antibiotic</label>
              <input id="antibiotic" type="checkbox" name="antibiotic" value="True">
              <input id="antibioticHidden" type="hidden" name="antibiotic" value="False">

              <label for="banging">Banging</label>
              <input id="banging" type="checkbox" name="banging" value="True">
              <input id="bangingHidden" type="hidden" name="banging" value="False">
            </div>
          </div>

          <div class="container">
            <div id="flag" class="bubble hidden">
              <label for="flag_color">Flag color</label>
              <input type="color" name="flag_color" value={{flag_color}} />
              <div class="color-picker"></div>

              <label for="flag_color_secondary">Flag secondary color</label>
              <input type="color" name="flag_color_secondary" value={{flag_color_secondary}} />

              <label for="flag_pattern">Flag pattern </label>
              <select name="flag_pattern" value={{flag_pattern}}>
                <option value="{{flag_pattern}}" selected hidden>{{flag_pattern}}</option>
                <option value="plain">plain</option>
                <option value="vstripe">vstripe</option>
                <option value="hstripe">hstripe</option>
                <option value="dstripe">dstripe</option>
                <option value="checker">checker</option>
                <option value="spot">spot</option>
              </select>
            </div>
          </div>
          <input id="total_cost" type="hidden" name="total_cost" for="total_cost" value="{{total_cost}}"></input>
          <input id="private" type="hidden" name="private" value="{{private}}"></input>

          <div class="container">
            <div id="submit" class="bubble hidden">
              <label for="buggy_name">Enter a name for the buggy</label>
              <input type="text" name="buggy_name" maxlength="30" value={{buggy_name}}>
              <br>
              <input type="submit" name="task" value="UPDATE" class="button" />
              <input type="submit" name="task" value="NEW COPY" class="button" />
              <input type="submit" name="task" value="DELETE" class="button" />
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>
</div>




<script type="text/javascript">
  let getBuggy = async (user, index) => {
    let response = await fetch(`http://localhost:5000/api/${user}/${index}`);
    let message = await response.json();
    console.log(message);
    loadNewCar(message);
  }

  function buildProfiles() {
    let raw = {{ profiles | tojson}} 
    let profiles = [];

    for (let i = 0; i < raw.length; i++) {
      profiles.push(JSON.parse(raw[i]))
    }

    return profiles
  }

  function appendBuggies() {
    // this all gets linted even though it works fine
    let profiles = buildProfiles()

    let user = "temp"
    let availableBuggies = document.getElementsByClassName("buggies");

    for (let buggy = 0; buggy < availableBuggies.length; buggy++) {
      for (let i = 0; i < profiles.length; i++) {
        let node = document.createElement("DIV");

        let nameChild = document.createElement("SPAN");
        let nameContent= document.createTextNode(`${profiles[i].name}`)
        nameChild.style.width = "50%"
        nameChild.appendChild(nameContent);

        let idChild = document.createElement("SPAN"); 
        let idContent= document.createTextNode(`${profiles[i].privateID}`)
        idChild.style.fontSize = "0.75em"
        idChild.appendChild(idContent);

        let colorChild = document.createElement("SPAN");
        colorChild.style.backgroundColor = `${profiles[i].primary_color}`

        
        node.setAttribute("onclick", `getBuggy("${user}", ${profiles[i].privateID})`)
        node.appendChild(nameChild);
        node.appendChild(idChild);
        node.appendChild(colorChild);
        availableBuggies[buggy].appendChild(node)

      }
    }
  }

  document.body.onload = appendBuggies();

  let active = "buggies";

</script>

<script type="text/javascript">
  function remove() {
    document.getElementById("filter").style.filter = "blur(0px)"
    document.getElementById("welcome").style.display = "none"
  }

  let slider = document.getElementById("slider");
  let output = document.getElementById("value");
  output.innerText = slider.value;

  let slider_two = document.getElementById("slider_two");
  let output_two = document.getElementById("value_two");
  output_two.innerText = slider_two.value;

  slider.oninput = () => {
    output.innerText = slider.value;
    slider_two.min = slider.value;
    output_two.innerText = slider_two.value;
  }


  slider_two.oninput = () => {
    output_two.innerText = slider_two.value;
  }

</script>
<script src="/static/scripts/prices.js"></script>
<script src="/static/scripts/value.js"></script>
<script src="/static/scripts/resize.js"></script>

{% endblock %}